# Enhanced Precision System V3 改善提案一覧

## 評価尺度
- **おすすめ度**: 改善優先度の総合判断。★★★★★ が最優先。
- **精度向上見込み**: モデル精度 (Accuracy/F1) の想定改善幅。"+" は上振れ、"±0" は直接効果なし想定。
- **安定性向上**: 再現性・ドローダウン抑制への寄与を五段階で表現。
- **実装工数**: ★ が小工数、★★★★★ が大工数。

## 改善候補サマリー
| # | 改善テーマ | おすすめ度 | 精度向上見込み | 安定性向上 | 実装工数 | 想定効果・留意点 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 全データ学習（サンプリング停止） | ★★★★☆ | +0.3 〜 +0.5 pt | ★★★★☆ | ★★☆☆☆ | 学習再現性が向上し、陽性データ増で軽微に精度向上。計算時間は増だがノートPCで完走可能。 |
| 2 | WFO の全量化＆期間細分化 | ★★★★☆ | +0.2 〜 +0.4 pt | ★★★★★ | ★★☆☆☆ | 評価ばらつきを大幅縮小。ステップ数増に伴い計算リソースが急増。 |
| 3 | 外部データ統合制限の緩和/撤廃 | ★★★★☆ | +0.5 〜 +0.8 pt | ★★★☆☆ | ★★☆☆☆ | 為替・指数・商品データをフル活用。I/O とメモリ負荷増。レポート側の特徴量再計算も要更新。 |
| 4 | ファンダメンタル指標カバレッジ拡大 | ★★★☆☆ | +0.5 〜 +1.0 pt | ★★★☆☆ | ★★★☆☆ | API レート制限対策を前提に銘柄網羅性を高める。補完ロジックが複雑化。 |
| 5 | マクロ&センチメント代替データ導入 | ★★★☆☆ | +0.5 〜 +1.2 pt | ★★☆☆☆ | ★★★★☆ | ニュース/先物/ETF 等を追加し情報量拡大。取得・クレンジングの工数とノイズリスクが高い。 |
| 6 | ターゲット再設計（利益幅別/マルチクラス） | ★★★☆☆ | +0.3 〜 +0.7 pt | ★★★★☆ | ★★★☆☆ | ビジネスゴールに合わせたラベル化で損益安定性を強化。レポートと検証指標の再構築が必要。 |
| 7 | クラス不均衡対策（重み付け/SMOTE/Focal） | ★★★☆☆ | +0.4 〜 +0.8 pt | ★★★☆☆ | ★★☆☆☆ | 陽性不足を改善し、閾値依存の偏りを緩和。過学習に注意。 |
| 8 | ハイパーパラメータ自動最適化（Optuna 等） | ★★★★☆ | +0.5 〜 +1.0 pt | ★★★☆☆ | ★★★☆☆ | 複数 seed・fold での探索により粘り強い改善。計算コストとパラメータ管理が増。 |
| 9 | 特徴量拡張（イベント/セクター/非線形） | ★★★★☆ | +0.6 〜 +1.2 pt | ★★★☆☆ | ★★★☆☆ | 既存テクニカルを深化させ、相互作用を強化。リークチェックや冗長性排除が前提。 |
| 10 | モデル高度化（アンサンブル/深層学習） | ★★★☆☆ | +0.7 〜 +1.5 pt | ★★★☆☆ | ★★★★☆ | LightGBM に CatBoost/XGBoost や LSTM/TFT を組み合わせる。実装・運用の複雑性が高まる。 |
| 11 | パイプライン高速化（Arrow/並列化） | ★★☆☆☆ | ±0 pt | ★★★☆☆ | ★★☆☆☆ | 精度ではなく全量学習の実行性向上。開発効率と運用コストを下げる施策。 |
| 12 | 評価設計強化（Purged CV/バックテスト連動） | ★★★☆☆ | ±0 pt | ★★★★★ | ★★★☆☆ | 未来漏洩を防止し真の汎化性能を把握。指標自体は変わらないが運用判断が安定。 |
| 13 | データクレンジング強化（分割補正/異常除去） | ★★★★☆ | +0.2 〜 +0.5 pt | ★★★★☆ | ★★☆☆☆ | 入力品質向上で細かなブレを抑制。長期的な安定性が高まる。 |
| 14 | 予測確率キャリブレーション | ★★☆☆☆ | ±0 pt | ★★★☆☆ | ★★☆☆☆ | 推奨確率の信頼性が上がり意思決定が安定。精度指標は直接変化しない。 |
| 15 | 保有戦略最適化連動（利確/損切/保有日数最適化） | ★★☆☆☆ | ±0 pt（損益指標改善） | ★★★☆☆ | ★★★☆☆ | モデル出力とトレードルールを一体化し、実運用効果（Sharpe/WinRate）を向上。ルール設計・検証が必要。 |

## 個別解説

### 1. 全データ学習（サンプリング停止）
- **狙い**: ランダムサンプリングによる学習再現性の揺らぎ解消。陽性サンプルを最大限活用。
- **期待効果**: Accuracy/F1 で +0.3〜0.5 pt、期間ごとの結果差が縮小。
- **所要リソース**: メモリ 1〜2 GB 程度、学習時間 5〜10 分（環境依存）。
- **実装ポイント**: `train_final_model` と `walk_forward_optimization` の行数条件を調整。必要に応じて学習時間監視のロギング追加。
- **リスク**: 計算時間増加。高頻度の再学習バッチではスケジュール調整が必要。

### 2. ウォークフォワード検証の全量化＆期間細分化
- **狙い**: 評価ステップ毎のバラつきを減らし、期間別の勝ち筋/負け筋を把握。
- **期待効果**: 精度微増 (+0.2〜0.4 pt)、評価安定性大幅改善。
- **実装ポイント**: サンプリング条件解除、`step_size` を 21 日などへ縮小しマーケットレジーム別に結果分析。
- **リスク**: 計算量が指数的に増。実行時間のボトルネックとなるため並列化やキャッシュが必要になる場合あり。

### 3. 外部データ統合制限の緩和/撤廃
- **狙い**: 現状 10,000 行閾値で除外されている指数・コモディティデータを学習に反映。
- **期待効果**: +0.5〜0.8 pt 程度の精度向上と局面ごとの判断材料増。
- **実装ポイント**: `_find_latest_external_file` 選択ロジックの閾値調整、`load_and_integrate_data` での列選定を柔軟化。推奨レポート側も同じ特徴量を再計算できるよう更新。
- **リスク**: 特徴量が多すぎるとノイズ混入の恐れ。SelectKBest の閾値引き上げや欠損処理の強化が必須。

### 4. ファンダメンタル指標カバレッジ拡大
- **狙い**: 50 銘柄に制限された財務データ取得を 225 銘柄に近づけ、銘柄特性を正確に反映。
- **期待効果**: +0.5〜1.0 pt のポテンシャル。特に四半期決算期の勝率向上が期待。
- **実装ポイント**: API 認証トークンの再利用、リクエスト分割、キャッシュ、補完ロジックの最適化。
- **リスク**: API レート制限超過の恐れ。長時間バッチ運用が必要。

### 5. マクロ & センチメント代替データ導入
- **狙い**: ニュース、ソーシャルセンチメント、先物、海外ETFなどで市場環境を高粒度に把握。
- **期待効果**: +0.5〜1.2 pt。ただしデータ品質により逆効果もあり得る。
- **実装ポイント**: データソース選定（例: Kaggle, RapidAPI, Quandl）、正規化、遅延補正、リーク防止。
- **リスク**: コスト・ライセンス、ノイズ混入、運用体制の複雑化。

### 6. ターゲット再設計（利益幅別/マルチクラス）
- **狙い**: 「+1%ブレイクアウト」に限らず、複数リターンバンドや保有期間別のラベルを用意し業務目的に最適化。
- **期待効果**: 精度は +0.3〜0.7 pt、損益安定性の改善（シャープレシオ上昇等）が見込める。
- **実装ポイント**: ターゲット生成ロジックと評価指標を刷新。推奨レポートの出力フォーマットも合わせて変更。
- **リスク**: モデル複雑化で解釈が難しくなる。トレードルールとの整合性を常に検証する必要。

### 7. クラス不均衡対策（重み付け/SMOTE/Focal Loss）
- **狙い**: 陽性サンプル不足による閾値依存の偏りを緩和し、適合率・再現率バランスを改善。
- **期待効果**: +0.4〜0.8 pt。召喚率上昇に伴う損切増の可能性も要監視。
- **実装ポイント**: LightGBM の `is_unbalance` や `scale_pos_weight`、サンプル重み導入、または学習前のデータ拡張。
- **リスク**: 過学習リスク。ウォークフォワードでの検証を必須とする。

### 8. ハイパーパラメータ自動最適化（Optuna/Bayesian）
- **狙い**: 人手調整から脱却し、複数期間で安定動作する最適パラメータを探索。
- **期待効果**: +0.5〜1.0 pt。安定性も中程度向上。
- **実装ポイント**: Optuna で `n_estimators`, `max_depth`, `learning_rate`, `min_child_samples` 等を探索。多 seed・多 fold の評価設定が有効。
- **リスク**: 計算時間が長い。結果の再現性担保のためログと固定 seed 管理が必要。

### 9. 特徴量拡張（イベント/セクター/非線形）
- **狙い**: 特徴量空間を充実させ、単純指標では拾えないパターンを捕捉。
- **期待効果**: +0.6〜1.2 pt。銘柄や市況の多様性に強くなる。
- **実装ポイント**: イベント指標（決算日前後、配当落ち等）、セクター相対強度、非線形組み合わせ（Lag, Ratio, Interaction）などを体系的に追加。
- **リスク**: 特徴量爆発によるノイズ増加。SelectKBest の見直しや特徴量ストア管理が必要。

### 10. モデル高度化（アンサンブル/深層学習）
- **狙い**: LightGBM 以外のモデルを統合し、弱点補完と予測の多様性向上。
- **期待効果**: +0.7〜1.5 pt。ドローダウン削減にも寄与する可能性。
- **実装ポイント**: CatBoost/XGBoost のブレンド、Meta learner による Stacking、時系列モデル（Temporal Fusion Transformer, N-BEATS）などを PoC。
- **リスク**: 開発・推論コスト大。環境依存やハイパーパラメータ管理が複雑化。

### 11. パイプライン高速化（Arrow/並列化）
- **狙い**: 全量学習やハイパーパラメータ探索を支える基盤整備。
- **期待効果**: 精度は変わらないが、安定性を支えるバッチ実行時間短縮（★★★☆☆）。
- **実装ポイント**: pandas から PyArrow への移行、マルチプロセス処理、ステップ間キャッシュ。
- **リスク**: 互換性やメモリ管理の難度上昇。

### 12. 評価設計強化（Purged/Combinatorial CV, バックテスト連動）
- **狙い**: 未来漏洩を完全に排除し、バックテストとの整合性を高める。
- **期待効果**: 精度数値は変わらないが安定性は最大（★★★★★）。
- **実装ポイント**: Purged K-Fold、Combinatorial Purged CV、バックテストエンジンとの統合。
- **リスク**: 実装が複雑で検証に時間を要する。パラメータ探索も増大。

### 13. データクレンジング強化
- **狙い**: 株式分割、誤報値、欠損を正確に処理し、入力の異常を除去。
- **期待効果**: +0.2〜0.5 pt、安定性 ★★★★☆。
- **実装ポイント**: 分割・併合イベントの自動検知、出来高異常のフィルタリング、補完ルールの統一。
- **リスク**: データ前処理のロジックが複雑になりメンテナンス工数が増える。

### 14. 予測確率キャリブレーション
- **狙い**: 予測確率の信頼度を向上させ、レポートの意思決定に直結する情報を精緻化。
- **期待効果**: 精度自体は ±0 pt、安定性 ★★★☆☆。
- **実装ポイント**: Platt scaling や isotonic regression を holdout に適用。キャリブレーション結果を joblib に保存し推奨レポートでも適用。
- **リスク**: データ量が少ないとキャリブレーションが不安定。ターゲット変更時は再調整が必要。

### 15. 保有戦略最適化連動
- **狙い**: 推奨銘柄提示に加えて、利確/損切ラインや保有期間を最適化し、実運用の損益指標を向上。
- **期待効果**: モデル精度は ±0 pt だが、Sharpe Ratio や年間収益率の改善が期待。安定性 ★★★☆☆。
- **実装ポイント**: 過去データで保有戦略パラメータをグリッド探索→最適値を `production_config.yaml` 等へ反映→レポートに推奨ルールを出力。
- **リスク**: ルールが複雑になりすぎると過学習や運用手間が増える。定期的な再最適化が必須。

---
最終更新: 2025-09-23 22:49
